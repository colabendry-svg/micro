<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicrostockGenius Pro - AI Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // --- MASUKKAN API KEY ANDA DI SINI ---
        const API_KEY = "AIzaSyAIaVIQrupSDGhQjeftHrT0cJq3Fdu62xw"; 

        function initApp() {
            return {
                file: null,
                previewUrl: null,
                loading: false,
                magicLoading: false,
                ttsLoading: false,
                genLoading: false,
                generatedImageUrl: null,
                prompts: [],
                keywords: [],
                metadata: { 
                    title: '', 
                    description: '', 
                    altText: '', 
                    marketTrend: '', 
                    colorPalette: [], 
                    critique: '',
                    marketScore: 0,
                    technicalScore: 0
                },
                translations: {},
                socialCaption: '',
                error: '',
                userQuery: '',
                chatHistory: [],
                activeTab: 'insights',
                
                handleFile(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.file = file;
                    this.previewUrl = URL.createObjectURL(file);
                    this.resetData();
                },

                resetData() {
                    this.metadata = { title: '', description: '', altText: '', marketTrend: '', colorPalette: [], critique: '', marketScore: 0, technicalScore: 0 };
                    this.keywords = [];
                    this.generatedImageUrl = null;
                    this.chatHistory = [];
                    this.error = '';
                },

                async generateAnalysis() {
                    if (!this.checkApiKey()) return;
                    this.loading = true;
                    this.error = '';
                    
                    try {
                        const genAI = new GoogleGenerativeAI(API_KEY);
                        const model = genAI.getGenerativeModel({ 
                            model: "gemini-2.5-flash-preview-09-2025", 
                            generationConfig: { responseMimeType: "application/json" }
                        });
                        
                        const base64 = await this.toBase64(this.file);
                        const prompt = `Analisis gambar ini untuk kontributor microstock profesional. 
                        Berikan output JSON: 
                        { 
                          "title": "judul SEO friendly", 
                          "description": "deskripsi detail",
                          "altText": "deskripsi aksesibilitas",
                          "marketTrend": "tren pasar saat ini",
                          "marketScore": 85,
                          "technicalScore": 90,
                          "colorPalette": ["#Hex1", "#Hex2", "#Hex3", "#Hex4"],
                          "critique": "analisis komposisi dan pencahayaan",
                          "keywords": ["tag1", "tag2", "...25 keywords"],
                          "prompts": [{"id": 1, "text": "prompt gaya baru"}] 
                        }`;
                        
                        const result = await model.generateContent([
                            prompt,
                            { inlineData: { data: base64, mimeType: this.file.type } }
                        ]);
                        
                        const data = JSON.parse(result.response.text());
                        this.metadata = data;
                        this.keywords = data.keywords;
                        this.prompts = data.prompts;
                    } catch (err) {
                        this.error = "Gagal memproses data visual.";
                        console.error(err);
                    } finally {
                        this.loading = false;
                    }
                },

                async generateVisualInspiration() {
                    if (!this.checkApiKey()) return;
                    this.genLoading = true;
                    try {
                        const prompt = `A highly commercial microstock style variation of: ${this.metadata.title}. Professional photography, clean background, studio lighting, 8k resolution.`;
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ instances: { prompt: prompt }, parameters: { sampleCount: 1 } })
                        });
                        const result = await response.json();
                        this.generatedImageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    } catch (err) {
                        this.error = "Gagal membuat inspirasi visual.";
                    } finally {
                        this.genLoading = false;
                    }
                },

                async playTTS(text) {
                    if (!this.checkApiKey()) return;
                    this.ttsLoading = true;
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: `Berbicara dengan nada profesional: ${text}` }] }],
                                generationConfig: {
                                    responseModalities: ["AUDIO"],
                                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } }
                                }
                            })
                        });
                        const result = await response.json();
                        const pcmData = result.candidates[0].content.parts[0].inlineData.data;
                        const audioBlob = this.pcmToWav(pcmData, 24000);
                        new Audio(URL.createObjectURL(audioBlob)).play();
                    } catch (err) {
                        this.error = "Audio AI tidak tersedia.";
                    } finally {
                        this.ttsLoading = false;
                    }
                },

                pcmToWav(base64, sampleRate) {
                    const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;
                    const header = new ArrayBuffer(44);
                    const v = new DataView(header);
                    v.setUint32(0, 0x52494646, false); v.setUint32(4, 36 + buffer.byteLength, true);
                    v.setUint32(8, 0x57415645, false); v.setUint32(12, 0x666d7420, false);
                    v.setUint32(16, 16, true); v.setUint16(20, 1, true); v.setUint16(22, 1, true);
                    v.setUint32(24, sampleRate, true); v.setUint32(28, sampleRate * 2, true);
                    v.setUint16(32, 2, true); v.setUint16(34, 16, true);
                    v.setUint32(36, 0x64617461, false); v.setUint32(40, buffer.byteLength, true);
                    return new Blob([header, buffer], { type: 'audio/wav' });
                },

                checkApiKey() {
                    if (!API_KEY) { this.error = "API Key diperlukan untuk fitur AI."; return false; }
                    return true;
                },

                toBase64(file) {
                    return new Promise((r) => { const reader = new FileReader(); reader.onloadend = () => r(reader.result.split(',')[1]); reader.readAsDataURL(file); });
                },

                copy(text) { navigator.clipboard.writeText(text); }
            };
        }
        window.setupApp = initApp;
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <style>
        [x-cloak] { display: none !important; }
        body { background: #0b0e14; font-family: 'Plus Jakarta Sans', sans-serif; color: #e2e8f0; }
        .glass { background: rgba(23, 27, 38, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .accent-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%); }
        .tab-active { background: #1e293b; color: #818cf8; border-bottom: 2px solid #818cf8; }
        .progress-bar { height: 6px; border-radius: 10px; background: #1e293b; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 1s ease-out; }
        @keyframes pulse-border { 0% { border-color: #4f46e5; } 50% { border-color: #ec4899; } 100% { border-color: #4f46e5; } }
        .analyzing { animation: pulse-border 2s infinite; }
    </style>
</head>
<body x-data="setupApp()" x-cloak class="pb-12">
    
    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 accent-gradient rounded-lg flex items-center justify-center font-bold text-white">M</div>
            <span class="font-extrabold text-lg tracking-tight">Microstock<span class="text-indigo-400 font-normal">Genius</span></span>
        </div>
        <div class="flex items-center gap-4">
            <div x-show="loading" class="text-[10px] uppercase tracking-widest text-indigo-400 font-bold animate-pulse">Analisis AI Aktif</div>
            <div class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700"></div>
        </div>
    </nav>

    <div class="max-w-5xl mx-auto px-4 mt-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Upload & Preview -->
        <aside class="lg:col-span-4 space-y-6">
            <div :class="loading ? 'analyzing' : ''" class="glass rounded-[2rem] p-4 relative border-2 border-transparent transition-all">
                <template x-if="!previewUrl">
                    <div class="py-20 text-center">
                        <div class="text-5xl mb-4">ðŸš€</div>
                        <p class="text-sm font-semibold text-slate-400">Tarik gambar ke sini</p>
                        <p class="text-[10px] text-slate-600 mt-2">Mendukung JPG, PNG hingga 4MB</p>
                    </div>
                </template>
                <template x-if="previewUrl">
                    <img :src="previewUrl" class="w-full rounded-2xl shadow-2xl object-cover aspect-square">
                </template>
                <input type="file" @change="handleFile" class="absolute inset-0 opacity-0 cursor-pointer">
            </div>

            <button @click="generateAnalysis" :disabled="loading || !file" class="w-full py-4 accent-gradient rounded-2xl font-bold text-sm tracking-wide shadow-xl shadow-indigo-500/10 active:scale-95 transition-all disabled:opacity-20 flex justify-center items-center gap-3">
                <span x-show="!loading">ðŸ”¬ ANALISIS VISUAL PRO</span>
                <span x-show="loading" class="flex items-center gap-2">
                    <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    MENGHITUNG DATA...
                </span>
            </button>

            <div x-show="error" class="p-4 bg-red-500/10 border border-red-500/20 rounded-2xl text-red-400 text-xs text-center" x-text="error"></div>
        </aside>

        <!-- Right Column: Results & Dashboard -->
        <main class="lg:col-span-8 space-y-6">
            
            <template x-if="!metadata.title">
                <div class="h-full flex flex-col items-center justify-center glass rounded-[3rem] p-12 text-center opacity-40">
                    <div class="text-7xl mb-6">ðŸ“‰</div>
                    <h2 class="text-xl font-bold mb-2 text-slate-300">Belum Ada Data</h2>
                    <p class="text-sm max-w-xs">Unggah gambar untuk melihat wawasan AI, tren pasar, dan optimasi SEO.</p>
                </div>
            </template>

            <template x-if="metadata.title">
                <div class="space-y-6" x-transition>
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="glass rounded-3xl p-6">
                            <div class="flex justify-between mb-4">
                                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Market Demand</span>
                                <span class="text-sm font-black text-indigo-400" x-text="metadata.marketScore + '%'"></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-indigo-500" :style="'width:' + metadata.marketScore + '%'"></div>
                            </div>
                        </div>
                        <div class="glass rounded-3xl p-6">
                            <div class="flex justify-between mb-4">
                                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Technical Quality</span>
                                <span class="text-sm font-black text-pink-500" x-text="metadata.technicalScore + '%'"></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-pink-500" :style="'width:' + metadata.technicalScore + '%'"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs Section -->
                    <div class="glass rounded-[2rem] overflow-hidden">
                        <div class="flex border-b border-white/5">
                            <button @click="activeTab = 'insights'" :class="activeTab === 'insights' ? 'tab-active' : 'text-slate-500'" class="flex-1 py-4 text-[10px] font-bold uppercase tracking-widest transition-all">Insights</button>
                            <button @click="activeTab = 'seo'" :class="activeTab === 'seo' ? 'tab-active' : 'text-slate-500'" class="flex-1 py-4 text-[10px] font-bold uppercase tracking-widest transition-all">SEO & Tags</button>
                            <button @click="activeTab = 'creative'" :class="activeTab === 'creative' ? 'tab-active' : 'text-slate-500'" class="flex-1 py-4 text-[10px] font-bold uppercase tracking-widest transition-all">Inspirasi Visual</button>
                        </div>

                        <div class="p-8">
                            <!-- Insight Tab -->
                            <div x-show="activeTab === 'insights'" class="space-y-6">
                                <div class="flex justify-between items-start gap-4">
                                    <div class="space-y-1">
                                        <h3 class="text-2xl font-extrabold" x-text="metadata.title"></h3>
                                        <p class="text-sm text-slate-400 leading-relaxed" x-text="metadata.description"></p>
                                    </div>
                                    <button @click="playTTS(metadata.description)" class="p-3 bg-white/5 hover:bg-white/10 rounded-2xl transition-all">ðŸ”Š</button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4">
                                    <div class="space-y-2">
                                        <label class="text-[10px] font-bold text-slate-600 uppercase">Tren Pasar</label>
                                        <p class="text-xs italic text-indigo-300" x-text="metadata.marketTrend"></p>
                                    </div>
                                    <div class="space-y-2">
                                        <label class="text-[10px] font-bold text-slate-600 uppercase">Analisis Teknikal</label>
                                        <p class="text-xs text-slate-400" x-text="metadata.critique"></p>
                                    </div>
                                </div>
                                <div class="pt-4">
                                    <label class="text-[10px] font-bold text-slate-600 uppercase block mb-3">Color Palette</label>
                                    <div class="flex gap-3">
                                        <template x-for="color in metadata.colorPalette">
                                            <div class="group relative">
                                                <div @click="copy(color)" class="h-10 w-10 rounded-xl cursor-pointer border border-white/10 hover:scale-110 transition-transform" :style="'background-color:' + color"></div>
                                                <span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[8px] font-bold opacity-0 group-hover:opacity-100" x-text="color"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <!-- SEO Tab -->
                            <div x-show="activeTab === 'seo'" class="space-y-6">
                                <div class="bg-slate-900/40 p-5 rounded-2xl space-y-3">
                                    <label class="text-[10px] font-bold text-indigo-400 uppercase">Aksesibilitas (Alt Text)</label>
                                    <p class="text-xs leading-relaxed" x-text="metadata.altText"></p>
                                    <button @click="copy(metadata.altText)" class="text-[10px] font-bold text-slate-500 underline">Salin</button>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-4">
                                        <label class="text-[10px] font-bold text-slate-600 uppercase">Keywords Pro (25)</label>
                                        <button @click="copy(keywords.join(', '))" class="bg-indigo-500/20 text-indigo-400 text-[10px] px-3 py-1 rounded-full font-bold">Salin Semua</button>
                                    </div>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="word in keywords">
                                            <span class="bg-slate-800/80 px-3 py-1.5 rounded-lg text-[10px] text-slate-300 border border-white/5" x-text="word"></span>
                                        </template>
                                    </div>
                                </div>
                            </div>

                            <!-- Creative Tab -->
                            <div x-show="activeTab === 'creative'" class="space-y-6">
                                <div class="flex flex-col md:flex-row gap-6 items-center">
                                 
